/*----------------------------------------------------------------------------*/
/* Copyright (c) 2017-2018 FIRST. All Rights Reserved.                        */
/* Open Source Software - may be modified and shared by FRC teams. The code   */
/* must be accompanied by the FIRST BSD license file in the root directory of */
/* the project.                                                               */
/*----------------------------------------------------------------------------*/


/*
 * Autonomo v0.1
 */

package org.usfirst.frc.team3478.robot.subsystems;


import org.lambot3478.autonomous_step.AutonomousStep_Drive;
import org.lambot3478.autonomous_step.AutonomousStep_IntakeElevador;
import org.lambot3478.autonomous_steps.StepFactory_Drive;
import org.lambot3478.autonomous_steps.StepFactory_IntakeElevador;
import org.usfirst.frc.team3478.robot.RobotMap;

import com.ctre.phoenix.motorcontrol.ControlMode;
import com.ctre.phoenix.motorcontrol.can.TalonSRX;

import edu.wpi.first.wpilibj.Timer;
import edu.wpi.first.wpilibj.command.Subsystem;


public class Robot_Autonomo extends Subsystem {
	// Tiempo para interrupcion de seguridad
	private final double SAFETY_TIMER=15;
	
	// Arreglo de pasos del tren motriz 
	private AutonomousStep_Drive[] driveSteps={};
		/* // Ejemplo de secuencia de tren motriz
		 * {
		 * StepFactory_Drive.getNewVectorMoveTime(90,1.0,0.8),
		 * StepFactory_Drive.getNewVectorMoveTime(-90,1.0,0.8),
		 * StepFactory_Drive.getNewRotateDegrees(-180)};*/
	
	
	
	//Arreglo de pasos del intake y elevador
	private AutonomousStep_IntakeElevador[] intakeSteps={};
		/*// Ejemplo de secuencia de elevador
		 * {StepFactory_IntakeElevador.getNewLowerElevator(),
		 * StepFactory_IntakeElevador.getNewWait(1),
		 * StepFactory_IntakeElevador.getNewRaiseElevatorTime(0.7,2),
		 * StepFactory_IntakeElevador.getNewThrowBox(),
		 * StepFactory_IntakeElevador.getNewLowerElevator(),
		 * StepFactory_IntakeElevador.getNewGrabBox(),
		 * StepFactory_IntakeElevador.getNewRaiseElevatorTime(0.7,2),
		 * StepFactory_IntakeElevador.getNewThrowBox()};
		 */
	
	
	
	//arreglo para guadar los talons del chasis
	private TalonSRX[] talonsDrive;
	//arreglo para guadar los talons del elevador
	private TalonSRX[] talonsIntakeElevador;
	
	
	public Robot_Autonomo(){
		talonsDrive=new TalonSRX[]{RobotMap.frontLeft,RobotMap.frontRight,
				RobotMap.backLeft,RobotMap.backRight};
		talonsIntakeElevador=new TalonSRX[]{RobotMap.intakeHinge,
				RobotMap.intakeLeft,RobotMap.intakeRight,
				RobotMap.ElevadorMot};
	}
	public void initDefaultCommand() {
		//nada
	}
	private void driveStop(){
		for(TalonSRX talon:talonsDrive) {
			talon.set(ControlMode.PercentOutput, 0.0);
		}
	}
	private void intakeElevadorStop(){
		for(TalonSRX talon:talonsIntakeElevador) {
			talon.set(ControlMode.PercentOutput, 0.0);
		}
	}
	
	////funcion principal del autonomo////////////
	public void RunAuto() {
		/////////////////Seleccion de autonomo///////////////
		
		
		// Timer de seguridad
		Timer safetyTimer=new Timer();
		safetyTimer.start();
		///////////////////////
		Thread intakeElevadorThread=new Thread(new Runnable(){
			@Override
			public void run(){
				for(AutonomousStep_IntakeElevador step:intakeSteps){
					step.setup();
					step.start();
					while(safetyTimer.get()<SAFETY_TIMER&&!step.isFinished()){
						step.run();
					}
					intakeElevadorStop();
					if(safetyTimer.get()>=SAFETY_TIMER){
						break;
					}
				}
			}
		});
		intakeElevadorThread.start();
		
		
		
		for(AutonomousStep_Drive step:driveSteps){
			step.setup();
			step.start();
			while(safetyTimer.get()<SAFETY_TIMER&&!step.isFinished()){
				step.run();
			}
			driveStop();
			if(safetyTimer.get()>=SAFETY_TIMER){
				break;
			}
		}
		safetyTimer.stop();
		
		
		// Esperar a que los pasos del intake y elevador 
		// terminen de ejecutarse
		while(intakeElevadorThread.isAlive()){}
		
		// Detener los motores de los mecanismos del
		// autonomo
		driveStop();
		intakeElevadorStop();
	}
	
	/////////////////////////////////////////////
	
	/////////funcion que hace al final del autonomo////////
	public void EndAuto() {
	}
	///////////////////////////////////////////////////
	
}